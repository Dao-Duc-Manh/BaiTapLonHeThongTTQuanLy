<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Server - Qu·∫£n L√Ω H·ªá Th·ªëng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .status-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .period-btn.active { background-color: #f59e0b; }
    </style>
</head>
<body class="bg-[#f8fafc] flex min-h-screen">

    <!-- Sidebar -->
    <aside class="w-64 bg-gray-900 text-gray-400 p-6 flex flex-col fixed h-full">
        <div class="flex items-center gap-3 text-white mb-10">
            <div class="w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center shadow-lg shadow-amber-500/30">
                <i class="fas fa-server"></i>
            </div>
            <div class="leading-tight">
                <span class="text-lg font-bold block">Admin Server</span>
                <span class="text-[10px] text-green-500 font-bold flex items-center gap-1">
                    <span class="w-1.5 h-1.5 bg-green-500 rounded-full status-pulse"></span> TR·ª∞C TUY·∫æN
                </span>
            </div>
        </div>
        <nav class="space-y-1 text-sm flex-1">
            <a href="#" class="flex items-center gap-3 px-4 py-3 bg-amber-500 text-white rounded-xl shadow-lg shadow-amber-500/20">
                <i class="fas fa-chart-line"></i> T·ªïng quan
            </a>
            <a href="#" class="flex items-center gap-3 px-4 py-3 hover:bg-white/5 rounded-xl transition">
                <i class="fas fa-list-ul"></i> ƒê∆°n h√†ng <span id="badgeCount" class="ml-auto bg-amber-500 text-white px-2 py-0.5 rounded-full text-[10px] hidden">0</span>
            </a>
        </nav>
        <div class="text-[10px] text-gray-600 border-t border-white/5 pt-4">
            Thi·∫øt b·ªã ch·ªß: Windows PC (192.168.1.1)
        </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 ml-64 p-10">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Trung T√¢m ƒêi·ªÅu H√†nh</h1>
                <p class="text-sm text-gray-400">T·ª± ƒë·ªông nh·∫≠n y√™u c·∫ßu t·ª´ thi·∫øt b·ªã kh√°ch.</p>
            </div>
            <button onclick="clearData()" class="text-xs text-red-500 hover:underline">X√≥a l·ªãch s·ª≠ test</button>
        </header>

        <!-- Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
            <div class="bg-white p-6 rounded-2xl border shadow-sm">
                <p class="text-xs font-bold text-gray-400 uppercase">T·ªïng ƒë∆°n nh·∫≠n</p>
                <h3 id="statTotal" class="text-3xl font-bold mt-1">0</h3>
                <p class="text-xs text-gray-500 mt-1"><i class="fas fa-arrow-up text-green-500"></i> +12% so v·ªõi th√°ng tr∆∞·ªõc</p>
            </div>
            <div class="bg-white p-6 rounded-2xl border shadow-sm">
                <p class="text-xs font-bold text-gray-400 uppercase">Doanh thu d·ª± ki·∫øn</p>
                <h3 id="statRevenue" class="text-3xl font-bold mt-1 text-amber-600">0ƒë</h3>
                <p class="text-xs text-gray-500 mt-1"><i class="fas fa-arrow-up text-green-500"></i> +8% so v·ªõi th√°ng tr∆∞·ªõc</p>
            </div>
            <div class="bg-white p-6 rounded-2xl border shadow-sm">
                <p class="text-xs font-bold text-gray-400 uppercase">Doanh thu th·ª±c t·∫ø</p>
                <h3 id="statActualRevenue" class="text-3xl font-bold mt-1 text-green-600">0ƒë</h3>
                <p class="text-xs text-gray-500 mt-1"><i class="fas fa-arrow-up text-green-500"></i> +15% so v·ªõi th√°ng tr∆∞·ªõc</p>
            </div>
            <div class="bg-white p-6 rounded-2xl border shadow-sm">
                <p class="text-xs font-bold text-gray-400 uppercase">Tr·∫°ng th√°i Server</p>
                <h3 class="text-xl font-bold mt-2 text-green-500"><i class="fas fa-wifi mr-2"></i>ƒêang l·∫Øng nghe...</h3>
                <p class="text-xs text-gray-500 mt-1">Uptime: 99.9%</p>
            </div>
        </div>



        <!-- Service Packages -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
            <div class="bg-white rounded-2xl border shadow-sm p-6 hover:shadow-lg transition">
                <div class="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center mb-4">
                    <i class="fas fa-birthday-cake text-amber-600 text-xl"></i>
                </div>
                <h4 class="font-bold text-lg mb-2">Ti·ªác Sinh Nh·∫≠t</h4>
                <p class="text-sm text-gray-600 mb-4">T·ªï ch·ª©c ti·ªác sinh nh·∫≠t chuy√™n nghi·ªáp v·ªõi kh√¥ng gian trang tr√≠ ƒë·∫πp m·∫Øt</p>
                <div class="text-2xl font-bold text-amber-600 mb-2">T·ª´ 50tr</div>
                <button class="w-full bg-amber-500 text-white py-2 rounded-lg font-medium hover:bg-amber-600 transition">
                    Xem chi ti·∫øt
                </button>
            </div>

            <div class="bg-white rounded-2xl border shadow-sm p-6 hover:shadow-lg transition">
                <div class="w-12 h-12 bg-pink-100 rounded-xl flex items-center justify-center mb-4">
                    <i class="fas fa-heart text-pink-600 text-xl"></i>
                </div>
                <h4 class="font-bold text-lg mb-2">L·ªÖ C∆∞·ªõi</h4>
                <p class="text-sm text-gray-600 mb-4">D·ªãch v·ª• t·ªï ch·ª©c l·ªÖ c∆∞·ªõi tr·ªçn g√≥i v·ªõi ƒë·ªôi ng≈© chuy√™n nghi·ªáp</p>
                <div class="text-2xl font-bold text-amber-600 mb-2">T·ª´ 200tr</div>
                <button class="w-full bg-amber-500 text-white py-2 rounded-lg font-medium hover:bg-amber-600 transition">
                    Xem chi ti·∫øt
                </button>
            </div>

            <div class="bg-white rounded-2xl border shadow-sm p-6 hover:shadow-lg transition">
                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mb-4">
                    <i class="fas fa-briefcase text-blue-600 text-xl"></i>
                </div>
                <h4 class="font-bold text-lg mb-2">S·ª± ki·ªán Doanh nghi·ªáp</h4>
                <p class="text-sm text-gray-600 mb-4">T·ªï ch·ª©c h·ªôi ngh·ªã, workshop, team building chuy√™n nghi·ªáp</p>
                <div class="text-2xl font-bold text-amber-600 mb-2">T·ª´ 100tr</div>
                <button class="w-full bg-amber-500 text-white py-2 rounded-lg font-medium hover:bg-amber-600 transition">
                    Xem chi ti·∫øt
                </button>
            </div>

            <div class="bg-white rounded-2xl border shadow-sm p-6 hover:shadow-lg transition">
                <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mb-4">
                    <i class="fas fa-graduation-cap text-green-600 text-xl"></i>
                </div>
                <h4 class="font-bold text-lg mb-2">L·ªÖ T·ªët Nghi·ªáp</h4>
                <p class="text-sm text-gray-600 mb-4">T·ªï ch·ª©c l·ªÖ t·ªët nghi·ªáp trang tr·ªçng v√† √Ω nghƒ©a</p>
                <div class="text-2xl font-bold text-amber-600 mb-2">T·ª´ 80tr</div>
                <button class="w-full bg-amber-500 text-white py-2 rounded-lg font-medium hover:bg-amber-600 transition">
                    Xem chi ti·∫øt
                </button>
            </div>
        </div>

        <!-- Gallery S·ª± ki·ªán -->
        <div class="bg-white rounded-2xl border shadow-sm p-6 mb-10">
            <h4 class="font-bold text-lg mb-6 flex items-center gap-2">
                <i class="fas fa-images text-amber-500"></i>
                Gallery S·ª± ki·ªán
            </h4>
            <div class="grid grid-cols-2 gap-3">
                <div class="relative group overflow-hidden rounded-lg">
                    <img src="https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=400&auto=format&fit=crop" alt="Wedding" class="w-full h-full object-cover aspect-square group-hover:scale-110 transition duration-500">
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <span class="text-white text-sm font-bold">L·ªÖ C∆∞·ªõi</span>
                    </div>
                </div>
                <div class="relative group overflow-hidden rounded-lg">
                    <img src="https://images.unsplash.com/photo-1464349153735-7db50ed83c84?q=80&w=400&auto=format&fit=crop" alt="Birthday" class="w-full h-full object-cover aspect-square group-hover:scale-110 transition duration-500">
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <span class="text-white text-sm font-bold">Sinh Nh·∫≠t</span>
                    </div>
                </div>
                <div class="relative group overflow-hidden rounded-lg">
                    <img src="https://images.unsplash.com/photo-1515187029135-18ee286d815b?q=80&w=400&auto=format&fit=crop" alt="Corporate" class="w-full h-full object-cover aspect-square group-hover:scale-110 transition duration-500">
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <span class="text-white text-sm font-bold">Doanh nghi·ªáp</span>
                    </div>
                </div>
                <div class="relative group overflow-hidden rounded-lg">
                    <img src="https://images.unsplash.com/photo-1523240795612-9a054b0db644?q=80&w=400&auto=format&fit=crop" alt="Graduation" class="w-full h-full object-cover aspect-square group-hover:scale-110 transition duration-500">
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <span class="text-white text-sm font-bold">T·ªët Nghi·ªáp</span>
                    </div>
                </div>
            </div>
            <div class="mt-4 text-center">
                <button class="text-amber-600 text-sm font-medium hover:text-amber-700 transition">
                    Xem th√™m h√¨nh ·∫£nh ‚Üí
                </button>
            </div>
        </div>

        <!-- Revenue Chart -->
        <div class="bg-white rounded-2xl border shadow-sm p-6 mb-10">
            <h4 class="font-bold text-sm mb-4">Th·ªëng k√™ doanh thu t·ª´ kh√°ch h√†ng</h4>
            <div class="flex gap-2 mb-4">
                <button onclick="setChartPeriod('7days')" class="period-btn px-3 py-1 bg-amber-500 text-white text-xs rounded">7 ng√†y</button>
                <button onclick="setChartPeriod('1month')" class="period-btn px-3 py-1 bg-gray-500 text-white text-xs rounded">1 th√°ng</button>
                <button onclick="setChartPeriod('1year')" class="period-btn px-3 py-1 bg-gray-500 text-white text-xs rounded">1 nƒÉm</button>
            </div>
            <canvas id="revenueChart"></canvas>
        </div>

        <!-- Order Table -->
        <div class="bg-white rounded-2xl border shadow-sm overflow-hidden">
            <div class="p-4 border-b bg-gray-50 flex items-center justify-between">
                <h4 class="font-bold text-sm">Y√™u c·∫ßu th·ªùi gian th·ª±c</h4>
                <div id="syncIndicator" class="text-[10px] text-gray-400 flex items-center gap-1 opacity-0 transition-opacity">
                    <i class="fas fa-sync fa-spin"></i> ƒêang ƒë·ªìng b·ªô d·ªØ li·ªáu kh√°ch...
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="bg-gray-50 text-[10px] uppercase font-bold text-gray-400 border-b">
                        <tr>
                            <th class="px-6 py-4">ID / Kh√°ch h√†ng</th>
                            <th class="px-6 py-4">G√≥i d·ªãch v·ª•</th>
                            <th class="px-6 py-4">Gi√° tr·ªã</th>
                            <th class="px-6 py-4">Th·ªùi gian nh·∫≠n</th>
                            <th class="px-6 py-4">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="adminTableBody" class="divide-y">
                        <!-- D·ªØ li·ªáu s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Order Details Modal -->
    <div id="orderDetailsModal" class="fixed inset-0 bg-black/60 hidden z-[100] overflow-y-auto p-4 flex justify-center py-10">
        <div class="bg-white rounded-[2.5rem] w-full max-w-2xl h-fit overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-200">
            <!-- Modal Header -->
            <div class="p-8 border-b bg-gray-50 flex justify-between items-center">
                <div>
                    <h3 class="text-2xl font-extrabold text-gray-900">Chi Ti·∫øt ƒê∆°n H√†ng</h3>
                    <p class="text-sm text-gray-500">Th√¥ng tin chi ti·∫øt v·ªÅ l·ªãch ƒë·∫∑t c·ªßa kh√°ch h√†ng</p>
                </div>
                <button onclick="closeOrderDetailsModal()" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-200 transition">
                    <i class="fas fa-times text-gray-400"></i>
                </button>
            </div>

            <!-- Modal Content -->
            <div class="p-8">
                <div id="orderDetailsContent" class="space-y-6">
                    <!-- Order details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Sound -->
    <audio id="notifSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script>
        const socket = io();
        let orders = [];

        function loadOrders(orderList) {
            orders = orderList || [];
            const tableBody = document.getElementById('adminTableBody');
            const indicator = document.getElementById('syncIndicator');

            // Hi·ªÉn th·ªã hi·ªáu ·ª©ng ƒë·ªìng b·ªô
            indicator.classList.remove('opacity-0');
            setTimeout(() => indicator.classList.add('opacity-0'), 1000);

            // C·∫≠p nh·∫≠t th·ªëng k√™
            document.getElementById('statTotal').innerText = orders.length;
            let totalRevenue = 0;
            let actualRevenue = 0;

            tableBody.innerHTML = '';
            // Create a reversed copy for display but keep original orders for lookup
            const displayOrders = [...orders].reverse();
            displayOrders.forEach(order => {
                totalRevenue += order.total;
                // Calculate actual revenue from deposits (assuming 30% deposit)
                if (order.fullPaid) {
                    actualRevenue += order.total;
                } else if (order.depositPaid) {
                    actualRevenue += Math.round(order.total * 0.3);
                }
                tableBody.innerHTML += `
                    <tr class="hover:bg-amber-50/30 transition">
                        <td class="px-6 py-4">
                            <div class="font-bold">#${order.id} - ${order.customer}</div>
                            <div class="text-[10px] text-gray-400">${order.phone}</div>
                        </td>
                        <td class="px-6 py-4 font-medium text-amber-600">${order.package}</td>
                        <td class="px-6 py-4 font-bold text-gray-900">${order.total.toLocaleString()}ƒë</td>
                        <td class="px-6 py-4 text-gray-500">${order.time}</td>
                        <td class="px-6 py-4">
                            <button onclick="confirmOrder(${order.id})" class="px-3 py-1 bg-green-500 text-white text-[10px] font-bold rounded-lg hover:bg-green-600 transition">X√ÅC NH·∫¨N</button>
                            <button onclick="viewOrderDetails(${order.id})" class="ml-2 px-3 py-1 bg-blue-500 text-white text-[10px] font-bold rounded-lg hover:bg-blue-600 transition">XEM CHI TI·∫æT</button>
                            <div class="mt-2 space-y-1">
                                <button onclick="confirmDeposit(${order.id})" class="block w-full px-2 py-1 ${order.depositPaid ? 'bg-green-500' : 'bg-yellow-500'} text-white text-[9px] font-bold rounded hover:opacity-80 transition">${order.depositPaid ? 'ƒê·∫∂T C·ªåC ‚úì' : 'X√ÅC NH·∫¨N ƒê·∫∂T C·ªåC'}</button>
                                <button onclick="confirmFullPayment(${order.id})" class="block w-full px-2 py-1 ${order.fullPaid ? 'bg-green-500' : 'bg-purple-500'} text-white text-[9px] font-bold rounded hover:opacity-80 transition">${order.fullPaid ? 'THANH TO√ÅN ‚úì' : 'X√ÅC NH·∫¨N THANH TO√ÅN'}</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            document.getElementById('statRevenue').innerText = totalRevenue.toLocaleString() + 'ƒë';
            document.getElementById('statActualRevenue').innerText = actualRevenue.toLocaleString() + 'ƒë';

            // C·∫≠p nh·∫≠t badge menu
            const badge = document.getElementById('badgeCount');
            if(orders.length > 0) {
                badge.innerText = orders.length;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function confirmOrder(orderId) {
            socket.emit('confirmOrder', orderId);
        }

        // L·∫Øng nghe s·ª± ki·ªán t·ª´ server
        socket.on('loadOrders', (orderList) => {
            loadOrders(orderList);
        });

        socket.on('orderUpdate', (newOrder) => {
            document.getElementById('notifSound').play().catch(e => {});
            loadOrders([...orders, newOrder]);
        });

        socket.on('orderConfirmed', (orderId) => {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = 'ƒê√£ x√°c nh·∫≠n';
                loadOrders(orders);
            }
        });

        socket.on('paymentStatusUpdated', (data) => {
            const { orderId, depositPaid, fullPaid } = data;
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.depositPaid = depositPaid;
                order.fullPaid = fullPaid;
                loadOrders(orders);
            }
        });

        function clearData() {
            if(confirm("X√≥a to√†n b·ªô ƒë∆°n h√†ng test?")) {
                orders = [];
                loadOrders([]);
            }
        }

        function viewOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const content = document.getElementById('orderDetailsContent');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-400 uppercase tracking-widest mb-2">Th√¥ng tin ƒë∆°n h√†ng</label>
                            <div class="bg-gray-50 p-4 rounded-2xl">
                                <div class="font-bold text-lg">#${order.id}</div>
                                <div class="text-sm text-gray-600">Tr·∫°ng th√°i: <span class="font-medium ${order.status === 'ƒê√£ x√°c nh·∫≠n' ? 'text-green-600' : 'text-amber-600'}">${order.status || 'M·ªöI'}</span></div>
                                <div class="text-sm text-gray-600">Th·ªùi gian ƒë·∫∑t: ${order.time}</div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-400 uppercase tracking-widest mb-2">Th√¥ng tin kh√°ch h√†ng</label>
                            <div class="bg-gray-50 p-4 rounded-2xl">
                                <div class="font-bold">${order.customer}</div>
                                <div class="text-sm text-gray-600">${order.phone}</div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-400 uppercase tracking-widest mb-2">G√≥i d·ªãch v·ª•</label>
                            <div class="bg-gray-50 p-4 rounded-2xl">
                                <div class="font-bold text-amber-600">${order.package}</div>
                                <div class="text-sm text-gray-600">Phong c√°ch: ${order.style || 'Ch∆∞a ch·ªçn'}</div>
                                <div class="text-sm text-gray-600">T·ªïng ti·ªÅn: ${order.total.toLocaleString()}ƒë</div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-400 uppercase tracking-widest mb-2">Th√¥ng tin s·ª± ki·ªán</label>
                            <div class="bg-gray-50 p-4 rounded-2xl">
                                <div class="text-sm text-gray-600">Ng√†y t·ªï ch·ª©c: ${order.date || 'Ch∆∞a ch·ªçn'}</div>
                                <div class="text-sm text-gray-600">ƒê·ªãa ƒëi·ªÉm: ${order.location || 'Ch∆∞a ch·ªçn'}</div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-400 uppercase tracking-widest mb-2">D·ªãch v·ª• b·ªï sung</label>
                            <div class="bg-gray-50 p-4 rounded-2xl">
                                ${order.extras && order.extras.length > 0 ? order.extras.map(extra => `<div class="text-sm">‚Ä¢ ${extra}</div>`).join('') : '<div class="text-sm text-gray-500">Kh√¥ng c√≥ d·ªãch v·ª• b·ªï sung</div>'}
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-400 uppercase tracking-widest mb-2">Ghi ch√∫</label>
                            <div class="bg-gray-50 p-4 rounded-2xl">
                                <div class="text-sm">${order.note || 'Kh√¥ng c√≥ ghi ch√∫'}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('orderDetailsModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeOrderDetailsModal() {
            document.getElementById('orderDetailsModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function confirmDeposit(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            if (!order.depositPaid) {
                if (confirm(`X√°c nh·∫≠n kh√°ch h√†ng ${order.customer} ƒë√£ thanh to√°n ti·ªÅn ƒë·∫∑t c·ªçc?`)) {
                    order.depositPaid = true;
                    socket.emit('updatePaymentStatus', { orderId, depositPaid: true });
                    loadOrders(orders);
                }
            } else {
                if (confirm(`H·ªßy x√°c nh·∫≠n ƒë·∫∑t c·ªçc cho kh√°ch h√†ng ${order.customer}?`)) {
                    order.depositPaid = false;
                    socket.emit('updatePaymentStatus', { orderId, depositPaid: false });
                    loadOrders(orders);
                }
            }
        }

        function confirmFullPayment(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            if (!order.fullPaid) {
                if (confirm(`X√°c nh·∫≠n kh√°ch h√†ng ${order.customer} ƒë√£ thanh to√°n ƒë·∫ßy ƒë·ªß t·ªïng ti·ªÅn t·ªï ch·ª©c s·ª± ki·ªán?`)) {
                    order.fullPaid = true;
                    socket.emit('updatePaymentStatus', { orderId, fullPaid: true });
                    loadOrders(orders);
                }
            } else {
                if (confirm(`H·ªßy x√°c nh·∫≠n thanh to√°n ƒë·∫ßy ƒë·ªß cho kh√°ch h√†ng ${order.customer}?`)) {
                    order.fullPaid = false;
                    socket.emit('updatePaymentStatus', { orderId, fullPaid: false });
                    loadOrders(orders);
                }
            }
        }

        // Chart functionality
        let revenueChart;
        let currentPeriod = '7days';

        function initChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Doanh thu th·ª±c t·∫ø (VNƒê)',
                        data: [],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + 'ƒë';
                                }
                            }
                        }
                    }
                }
            });
            updateChart();
        }

        function setChartPeriod(period) {
            currentPeriod = period;
            // Update button styles
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('bg-amber-500');
                btn.classList.add('bg-gray-500');
            });
            event.target.classList.add('active');
            event.target.classList.remove('bg-gray-500');
            event.target.classList.add('bg-amber-500');
            updateChart();
        }

        function updateChart() {
            if (!revenueChart) return;

            let labels = [];
            let data = [];

            const now = new Date();
            let startDate;

            if (currentPeriod === '7days') {
                startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
                    labels.push(date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit' }));
                    data.push(calculateRevenueForDate(date));
                }
            } else if (currentPeriod === '1month') {
                startDate = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate() + 1);
                const weeks = [];
                for (let i = 3; i >= 0; i--) {
                    const weekStart = new Date(startDate.getTime() + i * 7 * 24 * 60 * 60 * 1000);
                    const weekEnd = new Date(weekStart.getTime() + 6 * 24 * 60 * 60 * 1000);
                    weeks.push({ start: weekStart, end: weekEnd });
                }
                weeks.forEach(week => {
                    labels.push(`Tu·∫ßn ${week.start.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit' })} - ${week.end.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit' })}`);
                    data.push(calculateRevenueForPeriod(week.start, week.end));
                });
            } else if (currentPeriod === '1year') {
                for (let i = 11; i >= 0; i--) {
                    const monthStart = new Date(now.getFullYear(), now.getMonth() - i, 1);
                    const monthEnd = new Date(now.getFullYear(), now.getMonth() - i + 1, 0);
                    labels.push(monthStart.toLocaleDateString('vi-VN', { month: 'short', year: 'numeric' }));
                    data.push(calculateRevenueForPeriod(monthStart, monthEnd));
                }
            }

            revenueChart.data.labels = labels;
            revenueChart.data.datasets[0].data = data;
            revenueChart.update();
        }

        function calculateRevenueForDate(date) {
            const dateStr = date.toISOString().split('T')[0];
            return orders
                .filter(order => {
                    if (!order.time) return false;
                    const orderDate = new Date(order.time);
                    return orderDate.toISOString().split('T')[0] === dateStr;
                })
                .reduce((total, order) => {
                    if (order.fullPaid) {
                        return total + order.total;
                    } else if (order.depositPaid) {
                        return total + Math.round(order.total * 0.3);
                    }
                    return total;
                }, 0);
        }

        function calculateRevenueForPeriod(startDate, endDate) {
            return orders
                .filter(order => {
                    if (!order.time) return false;
                    const orderDate = new Date(order.time);
                    return orderDate >= startDate && orderDate <= endDate;
                })
                .reduce((total, order) => {
                    if (order.fullPaid) {
                        return total + order.total;
                    } else if (order.depositPaid) {
                        return total + Math.round(order.total * 0.3);
                    }
                    return total;
                }, 0);
        }

        // Initialize chart when page loads
        document.addEventListener('DOMContentLoaded', initChart);

        // Update chart when orders change
        const originalLoadOrders = loadOrders;
        loadOrders = function(orderList) {
            originalLoadOrders(orderList);
            updateChart();
            updateDashboard();
        };

        // Dashboard functionality
        let packageChart;

        function initDashboard() {
            initPackageChart();
            updateDashboard();
        }

        function initPackageChart() {
            const ctx = document.getElementById('packageChart').getContext('2d');
            packageChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#f59e0b',
                            '#10b981',
                            '#3b82f6',
                            '#ef4444',
                            '#8b5cf6'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateDashboard() {
            updatePackageChart();
            updateTopCustomers();
            updateRecentActivities();
        }

        function updatePackageChart() {
            if (!packageChart) return;

            const packageCounts = {};
            orders.forEach(order => {
                const pkg = order.package || 'Ch∆∞a ch·ªçn';
                packageCounts[pkg] = (packageCounts[pkg] || 0) + 1;
            });

            const labels = Object.keys(packageCounts);
            const data = Object.values(packageCounts);

            packageChart.data.labels = labels;
            packageChart.data.datasets[0].data = data;
            packageChart.update();
        }

        function updateTopCustomers() {
            const customerTotals = {};
            orders.forEach(order => {
                const customer = order.customer;
                if (!customerTotals[customer]) {
                    customerTotals[customer] = { total: 0, orders: 0 };
                }
                customerTotals[customer].total += order.total;
                customerTotals[customer].orders += 1;
            });

            const topCustomers = Object.entries(customerTotals)
                .sort(([,a], [,b]) => b.total - a.total)
                .slice(0, 5);

            const topCustomersDiv = document.getElementById('topCustomers');
            topCustomersDiv.innerHTML = '';

            if (topCustomers.length === 0) {
                topCustomersDiv.innerHTML = '<p class="text-sm text-gray-500">Ch∆∞a c√≥ d·ªØ li·ªáu kh√°ch h√†ng</p>';
                return;
            }

            topCustomers.forEach(([customer, data], index) => {
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
                topCustomersDiv.innerHTML += `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="text-lg">${medal}</span>
                            <div>
                                <div class="font-medium text-sm">${customer}</div>
                                <div class="text-xs text-gray-500">${data.orders} ƒë∆°n h√†ng</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-sm text-amber-600">${data.total.toLocaleString()}ƒë</div>
                        </div>
                    </div>
                `;
            });
        }

        function updateRecentActivities() {
            const recentOrders = [...orders]
                .filter(order => order.time)
                .sort((a, b) => new Date(b.time) - new Date(a.time))
                .slice(0, 10);

            const activitiesDiv = document.getElementById('recentActivities');
            activitiesDiv.innerHTML = '';

            if (recentOrders.length === 0) {
                activitiesDiv.innerHTML = '<p class="text-sm text-gray-500">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</p>';
                return;
            }

            recentOrders.forEach(order => {
                const timeAgo = getTimeAgo(new Date(order.time));
                const statusColor = order.status === 'ƒê√£ x√°c nh·∫≠n' ? 'text-green-600' : 'text-amber-600';
                const statusIcon = order.status === 'ƒê√£ x√°c nh·∫≠n' ? 'fas fa-check-circle' : 'fas fa-clock';

                activitiesDiv.innerHTML += `
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="${statusIcon} text-amber-600 text-xs"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="text-sm">
                                <span class="font-medium">${order.customer}</span>
                                <span class="text-gray-500">ƒë·∫∑t g√≥i</span>
                                <span class="font-medium text-amber-600">${order.package}</span>
                            </div>
                            <div class="text-xs text-gray-500 flex items-center gap-2">
                                <span>${timeAgo}</span>
                                <span class="${statusColor}"><i class="${statusIcon} mr-1"></i>${order.status || 'M·ªöI'}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);

            if (diffInSeconds < 60) return 'v·ª´a xong';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} ph√∫t tr∆∞·ªõc`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} gi·ªù tr∆∞·ªõc`;
            return `${Math.floor(diffInSeconds / 86400)} ng√†y tr∆∞·ªõc`;
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            initDashboard();
        });
    </script>
</body>
</html>